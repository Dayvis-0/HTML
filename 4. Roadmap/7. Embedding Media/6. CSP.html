<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>CSP</title>
        <style>
            :root {
                color-scheme: light dark;
                padding: 100px;
            }
        </style>
    </head>
    <body>
        <h1>Content Security Policy (CSP)</h1>
        <!--La Política  de Seguridad de Contenido (CSP) es una función que ayuda a prevenir o minimizar 
        el riesgo de ciertos tipos de amenazas a la seguridad. Consiste en una serie de instrucciones de 
        un sitio web o un navegador, que le indican a este último que debe colocar restricciones sobre
        las cosas que el código que compone el sitio puede hacer.-->
        <p>
            <strong>Content Security Policy</strong> (CSP) is a feature that helps to prevent or minimize 
            the risk of certain types of security threats. It consists of a series of instructions from 
            a website to a browser, which instruct the browser to place restrictions on the things that 
            the code comprising the site is allowed to do.
        </p>
        <h2>CSP overview</h2>
        <p>
            A CSP should be delivered to the browser in the Content-Security-Policy response header. It 
            should be set on all responses to all requests, not just the main document.
        </p>
        <p>
            You can also specify it using the <code>http-equiv</code> attribute of your document's 
            <code>&lt;meta&gt;</code> element, and this is a useful option for some use cases, such as a 
            client-side-rendered single page app which has only static resources, because you can then 
            avoid relying on any server infrastructure. However, this option does not support all CSP features.
        </p>
        <p>
            The policy is specified as a series of directives, separated by semi-colons. Each directive 
            controls a different aspect of the security policy. Each directive has a name, followed by a 
            space, followed by a value. Different directives can have different syntaxes.
        </p>
        <p>For example, consider the following CSP:</p>
        <code>
            Content-Security-Policy: default-src 'self'; img-src 'self' example.com
        </code>
        <p>It sets two directives:</p>
        <img src="Images/csp_overview.png" alt="A CSP broken into its directives.">
        <p>
            The first directive, <code>default-src</code>, tells the browser to load only resources that 
            are same-origin with the document, unless other more specific directives set a different policy 
            for other resource types. The second, <code>img-src</code>, tells the browser to load images 
            that are same-origin or that are served from <code>example.com</code>.
        </p>
        <h2>Controlling resource loading</h2>
        <p>
            A CSP can be used to control the resources that a document is allowed to load. This is primarily 
            used for protection against cross-site scripting (XSS) attacks.
        </p>
        <h3>XSS and resource loading</h3>
        <p>
            A cross-site scripting (XSS) attack is one in which an attacker is able to execute their code 
            in the context of the target website. This code is then able to do anything that the website's 
            own code could do, including, for example:
        </p>
        <ul>
            <li>
                <p>access or modify the content of the site's loaded pages</p>
            </li>
            <li>
                <p>access or modify content in local storage</p>
            </li>
            <li>
                <p>
                    make HTTP requests with the user's credential, enabling them to impersonate the user 
                    or acces sensitive data
                </p>
            </li>
        </ul>
        <p>
            If sanitization fails, there are various forms the injected malicious code can take in the 
            document, including:
        </p>
        <ul>
            <li>
                <p>A <code>&lt;script&gt;</code> tag that links to a malicious source:</p>
                <code>&lt;script&gt;src="https://evil.example.com/hacker.js"&lt;/script&gt;</code>
            </li>
            <li>
                <p>A <code>&lt;script&gt;</code> tag that includes inline JavaScript:</p>
<pre><code>&lt;script&gt;
    console.log("You've been hacked!");
&lt;/script&gt;</code></pre>
            </li>
            <li>
                <p>An inline event handler:</p>
                <pre><code>&lt;img
    onmouseover="console.log(`You've been hacked!`)"
    src="thumbnail.jpg"
    alt=""/&gt;</code></pre>
            </li>
            <li>
                <p>A <code>javascript</code>: URL:</p>
                <code>
                    &lt;iframe src="javascript:console.log(`You've been hacked!`)"&gt;
                    &lt;/iframe&gt;
                </code>
            </li>
            <li>
                <p>A string argument to an unsafe API like <code>eval():</code></p>
                <code>eval("console.log(`You've been hacked!`)");</code>
            </li>
        </ul>
        <p>
            By controlling resource loading, a CSP can provide protection against all of these. With a 
            CSP, you can:
        </p>
        <ul>
            <li>define the permitted sources for JavaScript files and other resources, effectively blocking loads from <code>https://evil.example.com</code></li>
            <li>disable inline script tags</li>
            <li>allow only script tags which have the correct <a href="/en-US/docs/Glossary/Nonce">nonce</a> or hash set</li>
            <li>disable inline event handlers</li>
            <li>disable <code>javascript:</code> URLs</li>
            <li>disable dangerous APIs like <code>eval()</code></li>
        </ul>
        <h3>Fetch directives</h3>
        <p>
            Extracted from;
            <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Guides/CSP">MDN CSP</a>
        </p>
    </body>
</html>